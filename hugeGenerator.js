// 海量题库生成器 - 生成更多经典题目变体
const hugeGenerator = {
    baseId: 10000,
    shuffle(arr) { const r=[...arr]; for(let i=r.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[r[i],r[j]]=[r[j],r[i]];} return r; },
    pick(arr) { return arr[Math.floor(Math.random()*arr.length)]; },
    makeQ(id,unit,diff,q,c,w,a) { const opts=this.shuffle([c,...w.slice(0,3)]); const idx=opts.indexOf(c); const L=["A","B","C","D"];
        return {id,type:"choice",unit,difficulty:diff,score:2,content:q+"（　　）",options:opts.map((o,i)=>`${L[i]}. ${o}`),answer:L[idx],analysis:a}; },

    // 生物特征与分类大题库
    genBioFeatures() {
        const qs = []; let id = this.baseId;

        // 生物特征判断
        const features = [
            {f:"需要营养",e:"植物吸收水和无机盐",ne:"石头吸收水分"},
            {f:"能进行呼吸",e:"人呼出二氧化碳",ne:"蜡烛燃烧产生二氧化碳"},
            {f:"能排出废物",e:"人排汗",ne:"水蒸发"},
            {f:"能对刺激作出反应",e:"含羞草叶片合拢",ne:"铁生锈"},
            {f:"能生长",e:"小树长成大树",ne:"钟乳石变大"},
            {f:"能繁殖",e:"母鸡下蛋",ne:"机器生产产品"},
            {f:"有遗传和变异",e:"子女像父母",ne:"复印件像原件"}
        ];

        features.forEach(item => {
            qs.push(this.makeQ(id++,"unit1","easy",`下列能说明生物"${item.f}"特征的是`,item.e,[item.ne,"机器运转","河水流动"],`${item.e}说明生物${item.f}。`));
        });

        // 生物与非生物判断
        const living = ["草履虫","酵母菌","病毒","细菌","蘑菇","苔藓","蕨类","藻类","珊瑚虫","水螅","海葵","水母"];
        const nonliving = ["珊瑚","钟乳石","机器人","电脑","汽车","石头","冰块","云朵","火焰","闪电"];

        living.forEach(item => {
            qs.push(this.makeQ(id++,"unit1","easy",`下列属于生物的是`,item,this.shuffle(nonliving).slice(0,3),`${item}具有生命特征，属于生物。`));
        });

        nonliving.forEach(item => {
            qs.push(this.makeQ(id++,"unit1","easy",`下列不属于生物的是`,item,this.shuffle(living).slice(0,3),`${item}没有生命特征，不属于生物。`));
        });

        this.baseId = id;
        return qs;
    },

    // 细胞知识大题库
    genCellKnowledge() {
        const qs = []; let id = this.baseId;

        // 显微镜操作详细题
        const microscope = [
            {q:"显微镜的目镜越长，放大倍数",a:"越小",w:["越大","不变","先大后小"]},
            {q:"显微镜的物镜越长，放大倍数",a:"越大",w:["越小","不变","先小后大"]},
            {q:"目镜5×，物镜10×，放大倍数是",a:"50倍",w:["15倍","2倍","500倍"]},
            {q:"目镜10×，物镜10×，放大倍数是",a:"100倍",w:["20倍","1倍","1000倍"]},
            {q:"目镜10×，物镜20×，放大倍数是",a:"200倍",w:["30倍","2倍","2000倍"]},
            {q:"目镜10×，物镜45×，放大倍数是",a:"450倍",w:["55倍","4.5倍","4500倍"]},
            {q:"目镜16×，物镜40×，放大倍数是",a:"640倍",w:["56倍","2.5倍","6400倍"]},
            {q:"从低倍镜换高倍镜后，视野中细胞数目",a:"减少",w:["增多","不变","先增后减"]},
            {q:"从低倍镜换高倍镜后，视野亮度",a:"变暗",w:["变亮","不变","先暗后亮"]},
            {q:"调节粗准焦螺旋时镜筒升降幅度",a:"大",w:["小","不变","先大后小"]},
            {q:"调节细准焦螺旋时镜筒升降幅度",a:"小",w:["大","不变","先小后大"]},
            {q:"对光时应转动的结构是",a:"转换器和遮光器",w:["粗准焦螺旋","细准焦螺旋","镜臂"]},
            {q:"观察时应先用",a:"低倍镜",w:["高倍镜","油镜","目镜"]},
            {q:"制作洋葱表皮细胞装片时滴加的液体是",a:"清水",w:["生理盐水","碘液","酒精"]},
            {q:"制作人口腔上皮细胞装片时滴加的液体是",a:"生理盐水",w:["清水","碘液","酒精"]},
            {q:"染色时常用的染液是",a:"碘液",w:["清水","生理盐水","酒精"]}
        ];

        microscope.forEach(item => {
            qs.push(this.makeQ(id++,"unit2","medium",item.q,item.a,item.w,`${item.a}是正确答案。`));
        });

        // 细胞结构对比题
        const cellCompare = [
            {q:"植物细胞有而动物细胞没有的结构是",a:"细胞壁、叶绿体、液泡",w:["细胞膜","细胞核","线粒体"]},
            {q:"动物细胞和植物细胞都有的结构是",a:"细胞膜、细胞质、细胞核、线粒体",w:["细胞壁","叶绿体","液泡"]},
            {q:"能进行光合作用的细胞器是",a:"叶绿体",w:["线粒体","核糖体","高尔基体"]},
            {q:"能进行呼吸作用的细胞器是",a:"线粒体",w:["叶绿体","核糖体","高尔基体"]},
            {q:"储存遗传信息的结构是",a:"细胞核",w:["细胞膜","细胞质","液泡"]},
            {q:"控制物质进出的结构是",a:"细胞膜",w:["细胞壁","细胞核","液泡"]},
            {q:"保护和支持细胞的结构是",a:"细胞壁",w:["细胞膜","细胞核","液泡"]},
            {q:"储存营养物质的结构是",a:"液泡",w:["细胞膜","细胞核","叶绿体"]}
        ];

        cellCompare.forEach(item => {
            qs.push(this.makeQ(id++,"unit2","medium",item.q,item.a,item.w,`${item.a}是正确答案。`));
        });

        this.baseId = id;
        return qs;
    },

    // 植物生理大题库
    genPlantPhysiology() {
        const qs = []; let id = this.baseId;

        // 光合作用详细题
        const photosynthesis = [
            {q:"光合作用的原料是",a:"二氧化碳和水",w:["氧气和水","有机物和氧气","葡萄糖"]},
            {q:"光合作用的产物是",a:"有机物和氧气",w:["二氧化碳和水","葡萄糖和二氧化碳","淀粉和二氧化碳"]},
            {q:"光合作用的场所是",a:"叶绿体",w:["线粒体","细胞核","液泡"]},
            {q:"光合作用的条件是",a:"光",w:["氧气","二氧化碳","水"]},
            {q:"光合作用的能量转变是",a:"光能→化学能",w:["化学能→光能","热能→化学能","化学能→热能"]},
            {q:"光合作用的实质是",a:"合成有机物，储存能量",w:["分解有机物，释放能量","吸收氧气","释放二氧化碳"]},
            {q:"光合作用的意义是",a:"制造有机物，释放氧气",w:["分解有机物","吸收氧气","释放二氧化碳"]},
            {q:"验证光合作用产生淀粉用",a:"碘液",w:["石灰水","酒精","盐酸"]},
            {q:"验证光合作用产生氧气用",a:"带火星的木条",w:["碘液","石灰水","酒精"]},
            {q:"验证光合作用需要二氧化碳用",a:"氢氧化钠溶液",w:["碘液","酒精","盐酸"]},
            {q:"光合作用前将植物放在黑暗处的目的是",a:"消耗掉原有的淀粉",w:["增加淀粉","产生氧气","吸收二氧化碳"]},
            {q:"用酒精脱色的目的是",a:"溶解叶绿素",w:["溶解淀粉","杀死细胞","固定细胞"]}
        ];

        photosynthesis.forEach(item => {
            qs.push(this.makeQ(id++,"unit4","medium",item.q,item.a,item.w,`${item.a}是正确答案。`));
        });

        // 呼吸作用详细题
        const respiration = [
            {q:"呼吸作用的原料是",a:"有机物和氧气",w:["二氧化碳和水","葡萄糖和二氧化碳","淀粉和水"]},
            {q:"呼吸作用的产物是",a:"二氧化碳和水",w:["有机物和氧气","葡萄糖和氧气","淀粉和氧气"]},
            {q:"呼吸作用的场所是",a:"线粒体",w:["叶绿体","细胞核","液泡"]},
            {q:"呼吸作用的能量转变是",a:"化学能→其他形式能量",w:["光能→化学能","热能→化学能","其他能量→化学能"]},
            {q:"呼吸作用的实质是",a:"分解有机物，释放能量",w:["合成有机物，储存能量","吸收二氧化碳","释放氧气"]},
            {q:"呼吸作用进行的时间是",a:"时刻都在进行",w:["只在白天","只在夜间","只在有光时"]},
            {q:"验证呼吸作用产生二氧化碳用",a:"澄清石灰水",w:["碘液","酒精","带火星木条"]},
            {q:"储存粮食时保持干燥低温是为了",a:"抑制呼吸作用",w:["促进光合作用","增加营养","防止发芽"]},
            {q:"新疆的瓜果特别甜是因为",a:"昼夜温差大，呼吸作用弱",w:["光合作用弱","水分多","土壤肥沃"]}
        ];

        respiration.forEach(item => {
            qs.push(this.makeQ(id++,"unit4","medium",item.q,item.a,item.w,`${item.a}是正确答案。`));
        });

        // 蒸腾作用详细题
        const transpiration = [
            {q:"蒸腾作用的主要器官是",a:"叶",w:["根","茎","花"]},
            {q:"蒸腾作用的主要部位是",a:"气孔",w:["叶肉","叶脉","表皮"]},
            {q:"气孔由什么细胞构成",a:"保卫细胞",w:["表皮细胞","叶肉细胞","导管细胞"]},
            {q:"蒸腾作用散失的物质是",a:"水蒸气",w:["氧气","二氧化碳","有机物"]},
            {q:"蒸腾作用的意义是",a:"促进水分吸收和运输，降低叶片温度",w:["合成有机物","分解有机物","吸收二氧化碳"]},
            {q:"移栽植物时剪去部分枝叶是为了",a:"减少蒸腾作用",w:["减少光合作用","减少呼吸作用","增加营养"]},
            {q:"移栽植物选择阴天或傍晚是为了",a:"减少蒸腾作用",w:["增加光合作用","增加呼吸作用","增加营养"]},
            {q:"大树底下好乘凉主要是因为",a:"蒸腾作用降低温度",w:["光合作用","呼吸作用","遮挡阳光"]}
        ];

        transpiration.forEach(item => {
            qs.push(this.makeQ(id++,"unit4","easy",item.q,item.a,item.w,`${item.a}是正确答案。`));
        });

        this.baseId = id;
        return qs;
    },

    // 人体生理大题库
    genHumanPhysiology() {
        const qs = []; let id = this.baseId;

        // 消化系统详细题
        const digestion = [
            {q:"淀粉消化的起始部位是",a:"口腔",w:["胃","小肠","大肠"]},
            {q:"蛋白质消化的起始部位是",a:"胃",w:["口腔","小肠","大肠"]},
            {q:"脂肪消化的起始部位是",a:"小肠",w:["口腔","胃","大肠"]},
            {q:"淀粉最终消化成",a:"葡萄糖",w:["麦芽糖","氨基酸","甘油"]},
            {q:"蛋白质最终消化成",a:"氨基酸",w:["葡萄糖","甘油","脂肪酸"]},
            {q:"脂肪最终消化成",a:"甘油和脂肪酸",w:["葡萄糖","氨基酸","麦芽糖"]},
            {q:"唾液淀粉酶能消化",a:"淀粉",w:["蛋白质","脂肪","纤维素"]},
            {q:"胃蛋白酶能消化",a:"蛋白质",w:["淀粉","脂肪","纤维素"]},
            {q:"胆汁的作用是",a:"乳化脂肪",w:["消化蛋白质","消化淀粉","消化脂肪"]},
            {q:"胆汁由什么器官分泌",a:"肝脏",w:["胆囊","胰腺","胃"]},
            {q:"胆汁储存在",a:"胆囊",w:["肝脏","胰腺","胃"]},
            {q:"不含消化酶的消化液是",a:"胆汁",w:["唾液","胃液","肠液"]},
            {q:"消化和吸收的主要场所是",a:"小肠",w:["胃","大肠","口腔"]},
            {q:"小肠绒毛的作用是",a:"增大吸收面积",w:["分泌消化液","蠕动推进食物","消化食物"]},
            {q:"大肠的主要功能是",a:"吸收水分和无机盐",w:["消化食物","吸收营养","分泌消化液"]}
        ];

        digestion.forEach(item => {
            qs.push(this.makeQ(id++,"unit5","medium",item.q,item.a,item.w,`${item.a}是正确答案。`));
        });

        // 呼吸系统详细题
        const breathing = [
            {q:"呼吸系统的主要器官是",a:"肺",w:["鼻腔","气管","支气管"]},
            {q:"气体交换的场所是",a:"肺泡",w:["气管","支气管","鼻腔"]},
            {q:"呼吸道的作用是",a:"温暖、湿润、清洁空气",w:["气体交换","发出声音","吞咽食物"]},
            {q:"吸气时膈肌",a:"收缩，膈顶下降",w:["舒张，膈顶上升","不变","先收缩后舒张"]},
            {q:"呼气时膈肌",a:"舒张，膈顶上升",w:["收缩，膈顶下降","不变","先舒张后收缩"]},
            {q:"吸气时胸廓",a:"扩大",w:["缩小","不变","先扩大后缩小"]},
            {q:"呼气时胸廓",a:"缩小",w:["扩大","不变","先缩小后扩大"]},
            {q:"吸气时肺内气压",a:"低于外界气压",w:["高于外界气压","等于外界气压","先高后低"]},
            {q:"呼气时肺内气压",a:"高于外界气压",w:["低于外界气压","等于外界气压","先低后高"]},
            {q:"肺泡适于气体交换的特点是",a:"数量多、壁薄、外有毛细血管",w:["体积大","有纤毛","有黏液"]},
            {q:"人体呼出气体中增多的成分是",a:"二氧化碳和水蒸气",w:["氧气","氮气","稀有气体"]},
            {q:"人体呼出气体中减少的成分是",a:"氧气",w:["二氧化碳","氮气","水蒸气"]}
        ];

        breathing.forEach(item => {
            qs.push(this.makeQ(id++,"unit6","medium",item.q,item.a,item.w,`${item.a}是正确答案。`));
        });

        this.baseId = id;
        return qs;
    },

    // 循环系统大题库
    genCirculation() {
        const qs = []; let id = this.baseId;

        const circulation = [
            {q:"心脏壁最厚的腔是",a:"左心室",w:["右心室","左心房","右心房"]},
            {q:"心脏壁最薄的腔是",a:"右心房",w:["左心房","左心室","右心室"]},
            {q:"与主动脉相连的心腔是",a:"左心室",w:["右心室","左心房","右心房"]},
            {q:"与肺动脉相连的心腔是",a:"右心室",w:["左心室","左心房","右心房"]},
            {q:"与肺静脉相连的心腔是",a:"左心房",w:["右心房","左心室","右心室"]},
            {q:"与上下腔静脉相连的心腔是",a:"右心房",w:["左心房","左心室","右心室"]},
            {q:"体循环的起点是",a:"左心室",w:["右心室","左心房","右心房"]},
            {q:"体循环的终点是",a:"右心房",w:["左心房","左心室","右心室"]},
            {q:"肺循环的起点是",a:"右心室",w:["左心室","左心房","右心房"]},
            {q:"肺循环的终点是",a:"左心房",w:["右心房","左心室","右心室"]},
            {q:"动脉血变成静脉血发生在",a:"全身毛细血管",w:["肺部毛细血管","心脏","静脉"]},
            {q:"静脉血变成动脉血发生在",a:"肺部毛细血管",w:["全身毛细血管","心脏","动脉"]},
            {q:"肺动脉中流动的是",a:"静脉血",w:["动脉血","混合血","不确定"]},
            {q:"肺静脉中流动的是",a:"动脉血",w:["静脉血","混合血","不确定"]},
            {q:"主动脉中流动的是",a:"动脉血",w:["静脉血","混合血","不确定"]},
            {q:"上下腔静脉中流动的是",a:"静脉血",w:["动脉血","混合血","不确定"]},
            {q:"动脉血的特点是",a:"含氧丰富，颜色鲜红",w:["含氧少，颜色暗红","含二氧化碳多","含营养物质多"]},
            {q:"静脉血的特点是",a:"含氧少，颜色暗红",w:["含氧丰富，颜色鲜红","含二氧化碳少","含营养物质少"]}
        ];

        circulation.forEach(item => {
            qs.push(this.makeQ(id++,"unit7","hard",item.q,item.a,item.w,`${item.a}是正确答案。`));
        });

        this.baseId = id;
        return qs;
    },

    generateAll() {
        return [
            ...this.genBioFeatures(),
            ...this.genCellKnowledge(),
            ...this.genPlantPhysiology(),
            ...this.genHumanPhysiology(),
            ...this.genCirculation()
        ];
    }
};
